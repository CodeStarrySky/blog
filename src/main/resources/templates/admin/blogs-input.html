<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/admin-commons::admin-head('博客发布')"></head>
<body>
<!--导航条-->
<nav th:replace="admin/admin-commons::admin-nav"></nav>

<div class="content text-center" >
    <div class="col-md-8 col-md-offset-2" >
        <div class="m-margin-tb-tiny">
            <div class="btn-group" role="group" aria-label="...">
                <a  class="btn btn-default btn-lg active" style="outline: none" th:href="@{/admin/blogs-input}">&nbsp;发布&nbsp;</a>
                <a  class="btn btn-default btn-lg" style="outline: none" th:href="@{/admin/blogs}">&nbsp;列表&nbsp;</a>
            </div>
        </div>
        <form th:action="@{/admin/blog}" th:method="${blog}!=null?'put':'post'" id="save-blog-form" >
            <input th:if="${blog}!=null" type="hidden" name="id" th:value="${blog.id}">
            <input type="hidden" name="ifOriginal" id="if_original" th:value="${blog}!=null?${blog.ifOriginal}:true" >
        <div class="input-group input-group-lg" style="position: relative;margin-bottom: 19px">
            <div class="input-group-btn">
                <button id="iftype" type="button" class="btn btn-info dropdown-toggle"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="outline: none">原创&ensp;<span class="caret"></span></button>
                <ul class="dropdown-menu" style="min-width: 100%">
                    <li class="text-center"><span style="color: deepskyblue">原创</span></li>
                    <li role="separator" class="divider"></li>
                    <li class="text-center "><span style="color: firebrick;">转载</span></li>
                </ul>
            </div><!-- /btn-group -->
            <input type="text" class="form-control" name="title" th:value="${blog}!=null?${blog.title}:''" aria-label="..." placeholder="      请输入标题..." style="font-size: 18px">
        </div><!-- /input-group -->

        <div class="layout" style="position:relative;z-index: 99">
            <div id="m-editormd">
                <textarea style="display:none;" name="content" th:text="${blog}!=null?${blog.content}:''">
                </textarea>
            </div>

        </div>


        <div class="row " style="position:relative;">
            <div class="col-lg-6">
                <div class="input-group input-group-lg">
                    <span class="input-group-addon" id="types">分类</span>
                    <select class="form-control" aria-haspopup="true" aria-expanded="false" name="type.id" >
                        <option th:each="type:${types}" th:selected="${blog}!=null?${blog.type.id}==${type.id}:false" th:text="${type.typeName}" th:value="${type.id}" value="void">hahah1</option>
                    </select>

                </div><!-- /input-group -->
            </div><!-- /.col-lg-6 -->
            <div class="col-lg-6">
                <div class="input-group  input-group-lg" >
                    <select class="selectpicker" multiple data-max-options="3" data-multiple-separator=" " data-title="标 签"  name="tagIds" >
                        <option value="1" class="option_tag" th:each="tag:${tags}" th:selected="${blog}!=null?${#strings.contains(blog.tagIds,tag.id+',')}:false" th:value="${tag.id}" th:text="${tag.tagName}" data-content="<span class='label label-info content-option-tag'>[[${tag.tagName}]]</span>">spring boot</option>
                    </select>
                </div><!-- /input-group -->
            </div><!-- /.col-lg-6 -->
        </div><!-- /.row -->
        <div class="col-lg-6 input-group input-group-lg" style="margin-top: 16px;padding-right: 16px">
            <span class="input-group-addon" >首图</span>
            <input type="text" name="firstFigure" class="form-control" placeholder="地址"  aria-describedby="sizing-addon1" th:value="${blog}!=null?${blog.firstFigure}:''">
        </div>
        <div class="text-left" style="margin-top:16px;font-size: 16px;color: #00bbff" >
            <label class="checkbox-inline">
                <input type="checkbox"  name="recommend"  th:checked="${blog}!=null?${blog.recommend}:false">推荐
            </label>
            <label class="checkbox-inline">
                <input type="checkbox" name="appreciates" th:checked="${blog}!=null?${blog.appreciates}:false"> 赞赏
            </label>
            <label class="checkbox-inline">
                <input type="checkbox" name="commentabled" th:checked="${blog}!=null?${blog.commentabled}:false"> 评论
            </label>
        </div>
            <div class="modal fade" id="confirm_return_modal" data-backdrop="static" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header text-left">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" style="color: #dd5555">温馨提示</h4>
                        </div>
                        <div class="modal-body">
                            <h3 class="m-font-spaced m-opacity">您确定要不保存就返回？</h3>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-info" id="save_return">保存后返回</button>
                            <button type="button" class="btn btn-danger" id="directly_return">直接返回</button>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->


        <div class="text-right" style="position:relative;">
            <input type="hidden" name="published" value="true"/>
            <button type="button" id="goBack-btn" class="btn btn-danger btn-lg m-padded-lr m-margin-large"  style="outline: none">返回</button>
            <button type="button" id="save-btn"   class="btn btn-default btn-lg m-padded-lr m-margin-large"  style="outline: none">保存</button>
            <button type="button" id="published-btn" class="btn btn-info btn-lg m-padded-lr m-margin-large"  style="outline: none" th:text="${blog}!=null?'更新':'发布'">发布</button>
        </div>
        </form>
    </div>

</div>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<script src="../../static/lib/editormd/editormd.min.js" th:src="@{/lib/editormd/editormd.min.js}"></script>

<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous">
</script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.17/dist/js/bootstrap-select.min.js"></script>


<script>
    $(function () {
        change_original();
        //编辑时初始化原创或转载
        function change_original() {
            var ifOriginal = $("#if_original").val();
            console.log(ifOriginal)
            if(ifOriginal=="false") {
                $("#iftype").removeClass("btn-info");
                $("#iftype").addClass("btn-danger");
                $("#iftype").html("转载&ensp;").append("<span class='caret'></span>");
            }
        }
        $("ul.dropdown-menu").on("click", "li",function () {
                // var val = $(this).children().test();
            var val = $(this).children().text();
            if(val=="转载"){
                $("#iftype").removeClass("btn-info");
                $("#iftype").addClass("btn-danger");
                $("#iftype").html("转载&ensp;").append("<span class='caret'></span>");
                $("#if_original").val("false");

            }else if(val=="原创"){
                $("#iftype").removeClass("btn-danger");
                $("#iftype").addClass("btn-info");
                $("#iftype").html("原创&ensp;").append("<span class='caret'></span>");
                $("#if_original").val("true");

            }else {
                return ;
            }
        })

        $("#save-btn").click(function(){
            save();
            return false;
        });
        $("#published-btn").click(function(){
            $("[name='published']").val(true);
            $("#save-blog-form").submit();
            return false;
        });
        $("#goBack-btn").click(function () {
            $("#confirm_return_modal").modal();
            return false;
        });
        $('#save_return').click(function () {
            save();
            $('#confirm_return_modal').modal('hide');
            return false;
        })
        $('#directly_return').click(function () {
            window.location.href="/admin/blogs";
            $('#confirm_return_modal').modal('hide');
            return false;
        })
        function save(){
            $("[name='published']").val(false);
            $("#save-blog-form").submit();
        }

        //对select下拉列表进行初始化
        $('.selectpicker>option').each(function (i) {
            $(this).attr("data-content","<span class='label label-info'>"+$(this).text()+"</span>")
        })
    })


</script>
<script type="text/javascript">
    var contentEditor;

    $(function() {
        contentEditor = editormd("m-editormd", {
            width   : "100%",
            height  : 599,
            syncScrolling : "single",
            path    : "/lib/editormd/lib/"
        });


        /*
        // or
        testEditor = editormd({
            id      : "test-editormd",
            width   : "90%",
            height  : 640,
            path    : "../lib/"
        });
        */
    });








</script>

</body>
</html>